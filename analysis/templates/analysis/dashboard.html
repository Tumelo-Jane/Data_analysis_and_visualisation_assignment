{% extends "analysis/base.html" %}
{% load static %}
{% block title %}South Africa: GDP & Inflation{% endblock %}

{% block content %}
  <!-- HERO -->
  <section class="hero card">
    <div>
      <h1 class="h1">South Africa: GDP & Inflation</h1>
      <p class="muted">A guided, visual summary with clean charts and key facts (1994 marked with a dashed line when in range).</p>
    </div>
    <div class="btnrow">
      <button id="reload" class="btn">Reload data</button>
      <label class="check"><input type="checkbox" id="showGDP" checked /> GDP</label>
      <label class="check"><input type="checkbox" id="showInfl" checked /> Inflation</label>
      <button id="resetZoom" class="btn ghost">Reset Zoom</button>
      <button id="datasetBtn" class="btn">Datasets</button>
    </div>
  </section>

  <!-- KPI GRID -->
  <section class="grid-4">
    <div class="card kpi">
      <div class="kpi-top"><div class="kpi-label">Records</div><span class="kpi-dot"></span></div>
      <div class="kpi-value" id="kpiRecords">0</div>
      <div class="kpi-foot">Rows after merge</div>
    </div>
    <div class="card kpi">
      <div class="kpi-top"><div class="kpi-label">Unique Years</div><span class="kpi-dot"></span></div>
      <div class="kpi-value" id="kpiCategories">0</div>
      <div class="kpi-foot">Time coverage</div>
    </div>
    <div class="card kpi">
      <div class="kpi-top"><div class="kpi-label">Avg Inflation</div><span class="kpi-dot"></span></div>
      <div class="kpi-value"><span id="kpiAvg">0</span><span class="muted">%</span></div>
      <div class="kpi-foot">Long-run mean</div>
    </div>
    <div class="card kpi">
      <div class="kpi-top"><div class="kpi-label">Max GDP</div><span class="kpi-dot"></span></div>
      <div class="kpi-value" id="kpiMax">0</div>
      <div class="kpi-foot">Peak yearly value</div>
    </div>
  </section>

  <!-- FINDINGS / STORY -->
  <section class="card">
    <h3 class="h3">What the data shows</h3>
    <div id="storyContent" class="story-body"></div>
  </section>

  <!-- MAIN CHARTS ROW 1 -->
  <section class="grid-2">
    <div class="card">
      <div class="card-head"><h3 class="h3">GDP over Time</h3><div class="muted">Line</div></div>
      <canvas id="gdpChart" height="140"></canvas>
      <div class="figcap" id="cap-gdp">—</div>
    </div>
    <div class="card">
      <div class="card-head"><h3 class="h3">Inflation over Time</h3><div class="muted">Bars</div></div>
      <canvas id="inflChart" height="140"></canvas>
      <div class="figcap" id="cap-infl">—</div>
    </div>
  </section>

  <!-- MAIN CHARTS ROW 2 -->
  <section class="grid-2">
    <div class="card">
      <div class="card-head"><h3 class="h3">Overlay</h3><div class="muted">GDP & Inflation together</div></div>
      <canvas id="overlayChart" height="160"></canvas>
      <div class="figcap" id="cap-overlay">—</div>
    </div>
    <div class="card">
      <div class="card-head"><h3 class="h3">GDP vs Inflation</h3><div class="muted">Scatter + line</div></div>
      <canvas id="scatterChart" height="160"></canvas>
      <div class="figcap" id="cap-scatter">—</div>
    </div>
  </section>

  <!-- MAIN CHARTS ROW 3 -->
  <section class="grid-2">
    <div class="card">
      <div class="card-head"><h3 class="h3">GDP YoY</h3><div class="muted">Area</div></div>
      <canvas id="yoyChart" height="160"></canvas>
      <div class="figcap" id="cap-yoy">—</div>
    </div>
    <div class="card">
      <div class="card-head"><h3 class="h3">YoY Breakdown</h3><div class="muted">Doughnut</div></div>
      <canvas id="donutChart" height="160"></canvas>
      <div class="figcap" id="cap-donut">—</div>
    </div>
  </section>

  <!-- MAIN CHARTS ROW 4 -->
  <section class="grid-2">
    <div class="card">
      <div class="card-head"><h3 class="h3">Rolling Averages (5y)</h3><div class="muted">Smooth trends</div></div>
      <canvas id="rollingChart" height="160"></canvas>
      <div class="figcap" id="cap-rolling">—</div>
    </div>
    <div class="card">
      <div class="card-head"><h3 class="h3">Inflation Histogram</h3><div class="muted">Distribution</div></div>
      <canvas id="histChart" height="160"></canvas>
      <div class="figcap" id="cap-hist">—</div>
    </div>
  </section>

  <!-- MAIN CHARTS ROW 5 -->
  <section class="grid-2">
    <div class="card">
      <div class="card-head"><h3 class="h3">Cumulative GDP Path</h3><div class="muted">Running sum</div></div>
      <canvas id="cumChart" height="160"></canvas>
      <div class="figcap" id="cap-cum">—</div>
    </div>
    <div class="card">
      <div class="card-head"><h3 class="h3">Inflation Volatility</h3><div class="muted">Rolling Std (5y)</div></div>
      <canvas id="volChart" height="160"></canvas>
      <div class="figcap" id="cap-vol">Inflation volatility (5-year rolling std).</div>
    </div>
  </section>

  <!-- OPTIONAL: YoY scatter -->
  <section class="card">
    <div class="card-head"><h3 class="h3">YoY Scatter</h3><div class="muted">GDP YoY vs Inflation YoY</div></div>
    <canvas id="yoyScatterChart" height="150"></canvas>
    <div class="figcap" id="cap-yoysc">YoY scatter: x = Δinflation, y = ΔGDP.</div>
  </section>
{% endblock %}
