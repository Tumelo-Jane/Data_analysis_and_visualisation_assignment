{% extends 'base.html' %}

{% block content %}
{% load static %}

<!-- Data Overview Section -->
<section id="description">
    <div class="overview-card">
        <h5 class="section-title">Data Overview</h5>
        <p class="overview-text">
            This dashboard compares South Africa's <strong>GDP Growth</strong> and <strong>Inflation Trends</strong>
            across pre- and post-apartheid periods. Key statistics are summarized in the cards below, while
            the charts visualize annual changes and correlations.
        </p>
    </div>
</section>

<!-- Statistics Cards Section -->
<section id="stats">
    <h4 class="stats-title">Inflation Stats</h4>
    <div class="stats-grid">
        <div class="stat-card mean-card">
            <div class="stat-icon back-mean">
                <i class="bi bi-calculator calculator"></i>
            </div>
            <h3 class="stat-number">7.84</h3>
            <p class="stat-label">Mean</p>
        </div>
        <div class="stat-card std-card">
            <div class="stat-icon back-std">
                <i class="bi bi-graph-up graph-up"></i>
            </div>
            <h3 class="stat-number">4.53</h3>
            <p class="stat-label">Standard Deviation</p>
        </div>
        <div class="stat-card min-card">
            <div class="stat-icon back-min">
                <i class="bi bi-arrow-down arrow-down"></i>
            </div>
            <h3 class="stat-number">-0.69</h3>
            <p class="stat-label">Minimum Value</p>
        </div>
        <div class="stat-card max-card">
            <div class="stat-icon back-max">
                <i class="bi bi-arrow-up arrow-up"></i>
            </div>
            <h3 class="stat-number">18.65</h3>
            <p class="stat-label">Maximum Value</p>
        </div>
    </div>

    <h4 class="stats-title">GDP Stats</h4>
    <div class="stats-grid">
        <div class="stat-card mean-card">
            <div class="stat-icon back-mean">
                <i class="bi bi-calculator calculator"></i>
            </div>
            <h3 class="stat-number">2.79</h3>
            <p class="stat-label">Mean</p>
        </div>
        <div class="stat-card std-card">
            <div class="stat-icon back-std">
                <i class="bi bi-graph-up graph-up"></i>
            </div>
            <h3 class="stat-number">2.62</h3>
            <p class="stat-label">Standard Deviation</p>
        </div>
        <div class="stat-card min-card">
            <div class="stat-icon back-min">
                <i class="bi bi-arrow-down arrow-down"></i>
            </div>
            <h3 class="stat-number">-6.17</h3>
            <p class="stat-label">Minimum Value</p>
        </div>
        <div class="stat-card max-card">
            <div class="stat-icon back-max">
                <i class="bi bi-arrow-up arrow-up"></i>
            </div>
            <h3 class="stat-number">7.94</h3>
            <p class="stat-label">Maximum Value</p>
        </div>
    </div>
</section>

<!-- Charts Section -->
<section id="charts">
    <div class="charts-row">
        <!-- Table -->
        <div class="chart-column left-column">
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th colspan="4" class="table-title">GDP & Inflation Description</th>
                        </tr>
                        <tr class="table-headers">
                            <th></th>
                            <th class="year-col">Year</th>
                            <th class="inflation-col">Inflation</th>
                            <th class="gdp-col">GDP</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">Count</th>
                            <td>63.000000</td>
                            <td>63.000000</td>
                            <td>63.000000</td>
                        </tr>
                        <tr>
                            <th scope="row">Mean</th>
                            <td>1992.000000</td>
                            <td>7.839404</td>
                            <td>2.786620</td>
                        </tr>
                        <tr>
                            <th scope="row">Std</th>
                            <td>18.330303</td>
                            <td>4.565871</td>
                            <td>2.640099</td>
                        </tr>
                        <tr>
                            <th scope="row">Min</th>
                            <td>1961.000000</td>
                            <td>-0.692030</td>
                            <td>-6.168918</td>
                        </tr>
                        <tr>
                            <th scope="row">25%</th>
                            <td>1976.500000</td>
                            <td>4.528904</td>
                            <td>1.277710</td>
                        </tr>
                        <tr>
                            <th scope="row">50%</th>
                            <td>1992.000000</td>
                            <td>6.425708</td>
                            <td>3.014480</td>
                        </tr>
                        <tr>
                            <th scope="row">75%</th>
                            <td>2007.500000</td>
                            <td>11.339223</td>
                            <td>4.563252</td>
                        </tr>
                        <tr>
                            <th scope="row">Max</th>
                            <td>2023.000000</td>
                            <td>18.654919</td>
                            <td>7.939609</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Bar Graph -->
        <div class="chart-column right-column">
            <div>
                <canvas id="barGraph"></canvas>
            </div>

            <!-- Correlation Card -->
            <div class="card shadow rounded-4 p-4 correlation-card">
                <div class="d-flex flex-column">
                    <div class="fs-1 fw-bold text-dark lh-sm">-0.3476</div>
                    <div class="fs-5 fw-medium text-secondary mt-2">Correlation Coefficient</div>
                </div>
                <div class="my-3"></div>
                <div class="d-flex flex-column">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="fw-medium text-secondary">Negative Correlation</div>
                        <div class="d-flex align-items-center fs-6 fw-semibold text-danger">
                            <i class="bi bi-arrow-down-short me-1"></i> -34.76%
                        </div>
                    </div>
                    <div class="progress mt-2" style="height: 0.5rem; border-radius: 1rem;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 34.76%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Visualization Section -->
<section id="viz">
    <!-- MultiLine Chart -->
    <div style="margin-bottom: 50px;">
        <canvas id="multiLineChart"></canvas>
    </div>

    <!-- Scatter Chart -->
    <div>
        <canvas id="scatterGraph"></canvas>
    </div>

    <!-- Pie & Doughnut Charts -->
    <div class="viz-row" style="margin-top: 50px; margin-bottom: 50px;">
        <div>
            <canvas id="pieChart"></canvas>
        </div>
        <div>
            <canvas id="doughnutChart"></canvas>
        </div>
    </div>

    <!-- GDP & Inflation Chart -->
    <div class="chart-full-width">
        <div style="margin-bottom: 50px;">
            <canvas id="gdpInflationChart"></canvas>
        </div>
    </div>

    <!-- Bar Chart -->
    <div class="chart-full-width">
        <div>
            <canvas id="barChart"></canvas>
        </div>
    </div>
</section>

<!-- Chart Scripts -->
<script>
    // line Chart
    const xValues = ["2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023"];
    const yValues = [6.13, 4.54, 6.57, 5.18, 4.52, 4.12, 3.21, 4.61, 7.04, 6.07];

    const ctx = document.getElementById("barGraph").getContext("2d");

    const plugin = {
        id: 'custom_canvas_background',
        beforeDraw: (chart) => {
            const ctx = chart.canvas.getContext('2d');
            ctx.save();
            ctx.globalCompositeOperation = 'destination-over';
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, chart.width, chart.height);
            ctx.restore();
        }
    };

    new Chart(ctx, {
        type: "line",
        data: {
            labels: xValues,
            datasets: [{
                label: "Inflation Rate (%)",
                data: yValues,
                borderColor: 'rgba(30, 144, 255, 1)',
                backgroundColor: 'rgba(30, 144, 255, 0.2)',
                borderWidth: 3,
                tension: 0.2,
                fill: false,
                pointBackgroundColor: 'rgba(30, 144, 255, 1)',
                pointRadius: 5
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true },
                title: {
                    display: true,
                    text: "Annual Inflation Rate in South Africa (2014–2023)",
                    font: { size: 18, weight: "bold" }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: "Year"
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: "Inflation Rate (%)"
                    }
                }
            }
        },
        plugins: [plugin]
    });

    // Scatter plot
    fetch("{% static 'scatter.json' %}")
        .then(response => response.json())
        .then(scatterData => {
            const ctx = document.getElementById("scatterGraph").getContext("2d");

            const plugin = {
                id: 'custom_canvas_background',
                beforeDraw: (chart) => {
                    const ctx = chart.canvas.getContext('2d');
                    ctx.save();
                    ctx.globalCompositeOperation = 'destination-over';
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, chart.width, chart.height);
                    ctx.restore();
                }
            };

            new Chart(ctx, {
                type: "scatter",
                data: {
                    datasets: [
                        {
                            label: "GDP vs Inflation",
                            data: scatterData.gdp.map((g, i) => ({ x: g, y: scatterData.inflation[i] })),
                            backgroundColor: "rgba(153, 102, 255, 0.6)",
                            borderColor: "rgb(153, 102, 255)",
                            pointRadius: 6
                        },
                        {
                            label: "GDP",
                            data: scatterData.gdp.map(g => ({ x: g, y: 0 })),
                            backgroundColor: "royalblue"
                        },
                        {
                            label: "Inflation",
                            data: scatterData.inflation.map(i => ({ x: 0, y: i })),
                            backgroundColor: "orange"
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true },
                        title: {
                            display: true,
                            text: "Correlation between GDP and Inflation (r = - 0.35)",
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: { display: true, text: 'GDP Growth (%)' }
                        },
                        y: {
                            title: { display: true, text: 'Inflation Rate (%)' }
                        }
                    }
                },
                plugins: [plugin]
            });
        });

    // Multi-line Chart
    fetch("{% static 'line.json' %}")
        .then(response => response.json())
        .then(line_data => {

            const ctx = document.getElementById("multiLineChart").getContext("2d");

            const plugin = {
                id: 'custom_canvas_background',
                beforeDraw: (chart) => {
                    const ctx = chart.canvas.getContext('2d');
                    ctx.save();
                    ctx.globalCompositeOperation = 'destination-over';
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, chart.width, chart.height);
                    ctx.restore();
                }
            };

            new Chart(ctx, {
                type: "line",
                data: {
                    labels: line_data.years,
                    datasets: [
                        {
                            label: "GDP YoY Change",
                            data: line_data.gdp,
                            borderColor: 'rgba(30, 144, 255, 1)',
                            backgroundColor: 'rgba(30, 144, 255, 0.15)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.2
                        },
                        {
                            label: "Inflation YoY Change",
                            data: line_data.inflation,
                            borderColor: 'rgba(255, 165, 0, 1)',
                            backgroundColor: 'rgba(255, 165, 0, 0.15)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true },
                        title: {
                            display: true,
                            text: "Year-over-Year Changes in GDP and Inflation",
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Year' }
                        },
                        y: {
                            title: { display: true, text: 'YoY Change (%)' }
                        },
                    }
                },
                plugins: [plugin]
            });
        });

    // Pie Chart - GDP Comparison
    fetch("{% static 'gdpMean.json' %}")
        .then(response => response.json())
        .then(pie_data => {
            const plugin = {
                id: 'custom_canvas_background',
                beforeDraw: (chart) => {
                    const ctx = chart.canvas.getContext('2d');
                    ctx.save();
                    ctx.globalCompositeOperation = 'destination-over';
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, chart.width, chart.height);
                    ctx.restore();
                }
            };

            new Chart(document.getElementById("pieChart").getContext("2d"), {
                type: "pie",
                data: {
                    labels: ["Pre-Apartheid GDP Mean", "Post-Apartheid GDP Mean"],
                    datasets: [{
                        backgroundColor: ["rgb(144, 202, 249)", "rgb(255, 182, 193)"],
                        data: pie_data.gdp_mean,
                        borderWidth: 2,
                        borderColor: "rgb(255, 255, 255)"
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true },
                        title: {
                            display: true,
                            text: "GDP Mean: Pre vs Post Apartheid (%)",
                        }
                    }
                },
                plugins: [plugin]
            });

            // Doughnut Chart - Inflation Mean Comparison
            new Chart(document.getElementById("doughnutChart").getContext("2d"), {
                type: "doughnut",
                data: {
                    labels: ["Pre-Apartheid Inflation Mean", "Post-Apartheid Inflation Mean"],
                    datasets: [{
                        backgroundColor: ["rgb(144, 202, 249)", "rgb(255, 182, 193)"],
                        data: pie_data.infl_mean,
                        borderWidth: 2,
                        borderColor: "rgb(255, 255, 255)"
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true },
                        title: {
                            display: true,
                            text: "Inflation Mean: Pre vs Post Apartheid (%)",
                        }
                    }
                },
                plugins: [plugin]
            });
        });

    // Best/Worst Performance Chart
    fetch("{% static 'bar_extremes.json' %}")
        .then(response => response.json())
        .then(bar_extremes => {
            const ctx = document.getElementById("gdpInflationChart").getContext("2d");

            const plugin = {
                id: 'custom_canvas_background',
                beforeDraw: (chart) => {
                    const ctx = chart.canvas.getContext('2d');
                    ctx.save();
                    ctx.globalCompositeOperation = 'destination-over';
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, chart.width, chart.height);
                    ctx.restore();
                }
            };

            new Chart(ctx, {
                type: "bar",
                data: {
                    labels: bar_extremes.labels,
                    datasets: [{
                        label: "Economic Indicator",
                        data: bar_extremes.values,
                        backgroundColor: bar_extremes.colors,
                        borderColor: bar_extremes.colors.map(c => c.replace('0.7', '1')),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: "Best and Worst Years for GDP and Inflation (Pre- and Post-Apartheid)",
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.label}: ${context.raw.toFixed(2)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Value (%)' }
                        }
                    }
                },
                plugins: [plugin]
            });
        });

    // Comparative Bar Chart
    fetch("{% static 'bar.json' %}")
        .then(response => response.json())
        .then(bar_data => {
            const ctx = document.getElementById("barChart").getContext("2d");

            const plugin = {
                id: 'custom_canvas_background',
                beforeDraw: (chart) => {
                    const ctx = chart.canvas.getContext('2d');
                    ctx.save();
                    ctx.globalCompositeOperation = 'destination-over';
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, chart.width, chart.height);
                    ctx.restore();
                }
            };

            new Chart(ctx, {
                type: "bar",
                data: {
                    labels: ["Pre-Apartheid (≤1993)", "Post-Apartheid (≥1994)"],
                    datasets: [
                        {
                            label: "GDP Mean",
                            backgroundColor: "rgba(54, 162, 235, 0.7)",
                            borderColor: "rgb(54, 162, 235)",
                            borderWidth: 2,
                            data: bar_data.bar_gdp
                        },
                        {
                            label: "Inflation Mean",
                            backgroundColor: "rgba(255, 99, 132, 0.7)",
                            borderColor: "rgba(255, 99, 132)",
                            borderWidth: 2,
                            data: bar_data.bar_inflation
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        title: {
                            display: true,
                            text: "Mean GDP and Inflation: Pre-Apartheid (<=1993) vs Post-Apartheid (>=1994)",
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Mean Value (%)' }
                        }
                    }
                },
                plugins: [plugin]
            });
        });
</script>

{% endblock %}